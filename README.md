# ã‚«ãƒ•ã‚§ã©ã“ï¼Ÿ iOSã‚¢ãƒ—ãƒª

è¿‘ãã®ã‚«ãƒ•ã‚§ã‚’ä¾¡æ ¼ãƒ»è·é›¢ãƒ»å–¶æ¥­æ™‚é–“ã§æ¯”è¼ƒã—ã€æœ€é©ãªã‚«ãƒ•ã‚§ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ iOS ã‚¢ãƒ—ãƒªã§ã™ã€‚SwiftUI ã¨ MapKit ã‚’æ´»ç”¨ã—ã€ãƒªã‚¹ãƒˆè¡¨ç¤ºã¨åœ°å›³è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆãªãŒã‚‰ã€ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ã§è‡ªåˆ†å¥½ã¿ã®ã‚«ãƒ•ã‚§ã‚’ç®¡ç†ã§ãã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

### ğŸ—ºï¸ ãƒªã‚¹ãƒˆãƒ»åœ°å›³ãƒ“ãƒ¥ãƒ¼
- ã‚«ãƒ•ã‚§ä¸€è¦§ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º
- åœ°å›³ãƒ“ãƒ¥ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆã¦ãƒ”ãƒ³ã§ä½ç½®ã‚’ç¢ºèª
- ã‚¿ãƒƒãƒ—ã§è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º

### â­ ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½
- ã‚«ãƒ•ã‚§ã‚’ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ãƒ»å‰Šé™¤
- ãŠæ°—ã«å…¥ã‚Šãƒ•ã‚£ãƒ«ã‚¿ã§ç™»éŒ²ã—ãŸã‚«ãƒ•ã‚§ã®ã¿è¡¨ç¤º
- UserDefaults ã§æ°¸ç¶šåŒ–

### ğŸ” æ¤œç´¢ãƒ»ã‚½ãƒ¼ãƒˆ
- åº—åã‚„ã‚¿ã‚°ã§æ¤œç´¢
- ä¾¡æ ¼é †ãƒ»è·é›¢é †ãƒ»ãŠã™ã™ã‚é †ã§ã‚½ãƒ¼ãƒˆ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### ğŸ•’ å–¶æ¥­æ™‚é–“è¡¨ç¤º
- å–¶æ¥­ä¸­/é–‰åº—ä¸­ãƒãƒƒã‚¸ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
- å–¶æ¥­æ™‚é–“ã®è©³ç´°è¡¨ç¤º
- æ›œæ—¥ãƒ»æ™‚é–“å¸¯ã”ã¨ã®åˆ¤å®š

### ğŸ“ è©³ç´°æƒ…å ±
- ä½æ‰€ãƒ»é›»è©±ç•ªå·ãƒ»å–¶æ¥­æ™‚é–“
- åœ°å›³ã‚¢ãƒ—ãƒªé€£æºï¼ˆä½æ‰€ã‚¿ãƒƒãƒ—ã§èµ·å‹•ï¼‰
- é›»è©±ã‚¢ãƒ—ãƒªé€£æºï¼ˆé›»è©±ç•ªå·ã‚¿ãƒƒãƒ—ã§ç™ºä¿¡ï¼‰

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **è¨€èª:** Swift 5.10 ä»¥é™
- **UI:** SwiftUI + Observation API + iOS 26 Liquid Glass
- **åœ°å›³:** MapKit
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:** ã‚¢ãƒ—ãƒªã‚·ã‚§ãƒ« + Core + Feature ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
- **ãƒ‡ãƒ¼ã‚¿å±¤:** `CafeDataProviding` ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ãƒ‡ãƒ¼ã‚¿æºã‚’æŠ½è±¡åŒ–ï¼ˆRemote API/Mockï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:** Supabase REST API
- **ãƒ“ãƒ«ãƒ‰:** `project.yml` ã‹ã‚‰ [XcodeGen](https://github.com/yonaskolb/XcodeGen) ã§ Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
- **è‡ªå‹•åŒ–:** Cursor Rules ã¨ MCP ã«ã‚ˆã‚‹ TODO / ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€£æº

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
1. ä¾å­˜ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   ```bash
   brew install xcodegen
   ```
2. Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
   ```bash
   xcodegen generate
   open CafeDoko.xcodeproj
   ```
3. `CafeDokoApp` ã‚¹ã‚­ãƒ¼ãƒ ã‚’ iOS 18 ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆå°†æ¥çš„ã«ã¯ iOS 26 ã¸æ›´æ–°äºˆå®šï¼‰ã§ãƒ“ãƒ«ãƒ‰ï¼†å®Ÿè¡Œ
4. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¯ `Config/cafe-doko-config.json` ã§ `mock`/`remote` ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ï¼ˆæœªä½œæˆã®å ´åˆã¯ãƒ¢ãƒƒã‚¯ JSON ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼‰

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
- `project.yml` â€” Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å˜ä¸€ã‚½ãƒ¼ã‚¹
- `App/` â€” ã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ SwiftUI ãƒ«ãƒ¼ãƒˆã‚·ãƒ¼ãƒ³
- `Features/` â€” æ©Ÿèƒ½åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤ï¼ˆåˆæœŸçŠ¶æ…‹ã§ã¯ `Core` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿ï¼‰
- `Resources/` â€” ã‚¢ã‚»ãƒƒãƒˆã‚«ã‚¿ãƒ­ã‚°ãŠã‚ˆã³å…±é€šãƒªã‚½ãƒ¼ã‚¹
- `Docs/` â€” Cursor Rulesã€MCP ç”¨ TODOã€è¨­è¨ˆè³‡æ–™ãªã©

## Cursor ã¨ MCP ã®æ´»ç”¨
- å…±æœ‰ãƒ«ãƒ¼ãƒ«ã¯ `Docs/cursor-rules.md` ã‚’å‚ç…§
- TODO ç®¡ç†ã¯ `Docs/todo.mcp.json`ï¼ˆMCP äº’æ›å½¢å¼ï¼‰ã§è¡Œã„ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨åŒæœŸ
- è¨­è¨ˆåˆ¤æ–­ã¯ `Docs/adr` ä»¥ä¸‹ã« ADR ã¨ã—ã¦è¨˜éŒ²ï¼ˆå¿…è¦ã«å¿œã˜ã¦ä½œæˆï¼‰

## MCP CLI ãƒ„ãƒ¼ãƒ«

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ MCP (Model Context Protocol) å¯¾å¿œã® CLI ãƒ„ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

```bash
# ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤º
swift Tools/mcp-cli/main.swift list

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿
swift Tools/mcp-cli/main.swift list --status=in_progress

# ã‚¿ã‚¹ã‚¯è©³ç´°è¡¨ç¤º
swift Tools/mcp-cli/main.swift show DC-001

# ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
swift Tools/mcp-cli/main.swift update DC-001 done
```

è©³ç´°ã¯ `Tools/mcp-cli/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ­ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ç¢ºèª

ã‚¢ãƒ—ãƒªã®ãƒ­ã‚°ç¢ºèªã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã¤ã„ã¦ã¯ã€**Observability ã‚¬ã‚¤ãƒ‰**ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

```bash
# Console.app ã§ã®ç¢ºèªæ–¹æ³•
open Docs/observability-guide.md

# ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
swift Tools/log-exporter/main.swift --format=json > logs.json
```

ä¸»ãªæ©Ÿèƒ½ï¼š
- ğŸ“Š **Console.app ã§ã®å³åº§ã«ãƒ­ã‚°ç¢ºèª**
- ğŸ“ **JSON/ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**
- ğŸ“ˆ **ãƒ¡ãƒˆãƒªã‚¯ã‚¹å®šç¾©ã¨KPI**ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã€æˆåŠŸç‡ãªã©ï¼‰
- ğŸ” **ãƒ­ã‚°åˆ†æã‚¯ã‚¨ãƒªä¾‹**ï¼ˆjqã‚’ä½¿ç”¨ï¼‰

è©³ç´°ã¯ [`Docs/observability-guide.md`](Docs/observability-guide.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
```
CafeDokoApp (App Shell)
â”œâ”€â”€ CafeDokoCore (å…±é€šæ©Ÿèƒ½)
â”‚   â”œâ”€â”€ RootAppModel (ã‚¢ãƒ—ãƒªå…¨ä½“ã®çŠ¶æ…‹ç®¡ç†)
â”‚   â”œâ”€â”€ FavoritesManager (ãŠæ°—ã«å…¥ã‚Šç®¡ç†)
â”‚   â”œâ”€â”€ BusinessHoursParser (å–¶æ¥­æ™‚é–“ãƒ‘ãƒ¼ã‚¹)
â”‚   â””â”€â”€ MCPBridge (ã‚¿ã‚¹ã‚¯ç®¡ç†é€£æº)
â””â”€â”€ DokoCafeFeature (ã‚«ãƒ•ã‚§æ©Ÿèƒ½)
    â”œâ”€â”€ DokoCafeViewModel (ã‚«ãƒ•ã‚§ãƒ‡ãƒ¼ã‚¿ç®¡ç†)
    â”œâ”€â”€ CafeDataProviding (ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹æŠ½è±¡åŒ–)
    â”‚   â”œâ”€â”€ RemoteCafeDataProvider (Supabase API)
    â”‚   â””â”€â”€ EmptyCafeDataProvider (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)
    â””â”€â”€ CafeImageProviding (ç”»åƒè¡¨ç¤º)
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
1. `RemoteCafeDataProvider` ãŒ Supabase REST API ã‹ã‚‰ã‚«ãƒ•ã‚§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
2. `DokoCafeViewModel` ãŒãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ã€ã‚½ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨
3. `ContentView` ãŒãƒªã‚¹ãƒˆ/ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
4. `FavoritesManager` ãŒãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹ã‚’æ°¸ç¶šåŒ–
5. `BusinessHoursParser` ãŒå–¶æ¥­æ™‚é–“ã‚’åˆ¤å®š

## APIè¨­å®š

### Supabaseæ¥ç¶š
ç’°å¢ƒå¤‰æ•°ã‚’ `Config/.secrets/secrets.env` ã«è¨­å®šï¼š
```bash
CAFE_DOKO_API_KEY=your_supabase_anon_key
```

`Config/cafe-doko-config.json` ã§æ¥ç¶šå…ˆã‚’è¨­å®šï¼š
```json
{
  "dataProvider": "remote",
  "remote": {
    "url": "https://your-project.supabase.co/rest/v1/cafes?select=*",
    "headers": {
      "apikey": "${CAFE_DOKO_API_KEY}",
      "X-API-Key": "${CAFE_DOKO_API_KEY}"
    }
  }
}
```

## ä»Šå¾Œã®äºˆå®š
- å®Ÿéš›ã®åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ãŸç²¾å¯†ãªåœ°å›³è¡¨ç¤º
- å–¶æ¥­æ™‚é–“ã®è‡ªå‹•æ›´æ–°
- ã‚«ãƒ•ã‚§ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»è©•ä¾¡æ©Ÿèƒ½
- è¨ªå•å±¥æ­´ã®è¨˜éŒ²
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼ˆãŠæ°—ã«å…¥ã‚Šã‚«ãƒ•ã‚§ã®å–¶æ¥­é–‹å§‹ãªã©ï¼‰
